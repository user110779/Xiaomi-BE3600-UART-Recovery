1. Підготовка обладнання та мережі
Підключення UART: *
* **TX роутера** -> **RX адаптера**
* **RX роутера** -> **TX адаптера**
* **GND** -> **GND** (спільна земля)
* **VCC НЕ ПІДКЛЮЧАЄМО!**

Налаштування ПК:
Статичний IP: 192.168.31.100 (маска 255.255.255.0).
Вимкнути брандмауер/антивірус (часто блокують TFTP).
Запустити Tftpd64, вказати папку з твоїми .bin дампами.
Термінал: Putty, швидкість 115200, 8N1.

2. Вхід в консоль U-Boot
Подай живлення на роутер.
В терміналі Putty почне бігти текст. Відразу затискай Enter або клавішу F (залежить від версії), поки не побачиш запит: IPQ5322#.

3. Конфігурація оточення (Environment)
Введи ці команди по черзі, щоб роутер зміг качати файли з твого ПК:

<p>Введи ці команди по черзі:</p>
<pre style="background-color: #f6f8fa; padding: 10px; border-radius: 5px;">
setenv ipaddr 192.168.31.1
setenv serverip 192.168.31.100
setenv netmask 255.255.255.0
saveenv
</pre>

Перевір зв'язок: ping 192.168.31.100. Має бути host is alive.

4. Робота з розділами (алгоритм "заливки")
BE3600 має NAND-пам'ять. Ми не можемо шити прямо з мережі у флеш, треба через проміжну точку в RAM (адреса 0x44000000).

Крок 1: Дивимось карту пам'яті Введи smeminfo або mtdparts. Тобі потрібно знайти початкову адресу (Start) та розмір (Size) розділів, які ти хочеш відновити.
Крок 2: Відновлення Kernel (Ядро) Приклад для розділу kernel (mtd23):

* **tftp 0x44000000 mtd23.bin — качаємо файл в RAM.**
* **nand erase 0x02000000 0x00800000 — стираємо розділ у Flash (адреси беремо з smeminfo!).**
* **nand write 0x44000000 0x02000000 ${filesize} — записуємо.**

Крок 3: Відновлення Rootfs (Система) Приклад для розділу rootfs (mtd24):

* **tftp 0x44000000 mtd24.bin**
* **nand erase 0x02800000 0x04000000**
* **nand write 0x44000000 0x02800000 ${filesize}**

5. Нюанс Dual Boot (Перемикання систем)
Xiaomi BE3600 має дві системи (rootfs та rootfs_1). Якщо ти прошив одну, а роутер намагається вантажити іншу — він знову впаде в ребут.

Щоб перевірити, яка система активна: printenv flag_boot_rootfs
Щоб змінити активну систему:

* **На першу: setenv flag_boot_rootfs 0**
* **На другу: setenv flag_boot_rootfs 1**
* **saveenv**

6. Фінальний запуск
Коли основні розділи (bootconfig, kernel, rootfs) відновлено:

* **reset**

Що робити, якщо не знаєш адрес nand write?
Якщо боїшся помилитися з адресами nand, є безпечніший варіант:
Завантаж тільки ядро в RAM: tftp 0x44000000 mtd23.bin.
Запусти його без запису на диск: bootm 0x44000000.
Роутер завантажиться в тимчасову систему. Тепер підключайся по SSH і використовуй просту команду: mtd write /tmp/mtd24.bin rootfs Це набагато безпечніше, бо система сама знає, куди писати.

---

Типова проблема: «Сміття» або ієрогліфи в консолі
Якщо після підключення в терміналі замість зрозумілого тексту біжать ієрогліфи, незрозумілі символи або порожні рядки — перевірте наступне:
Контакт GND (Земля): Це найчастіша причина. Якщо ви під’єднали тільки RX та TX, але забули про спільну «землю» (GND) між роутером та адаптером, дані будуть спотворюватися. Рівні сигналів стають нестабільними, і замість бітів термінал бачить «шум».
Швидкість (Baud Rate): Переконайтеся, що в налаштуваннях Putty/TeraTerm виставлено саме 115200. На інших швидкостях (наприклад, 9600 чи 57600) ви теж побачите «кадабру».
Переплутані RX/TX: Якщо логів немає зовсім — просто поміняйте місцями дроти RX та TX на адаптері. Це безпечно.
Якість дротів: Для UART краще використовувати максимально короткі дроти. Довгі «соплі» на високій швидкості 115200 ловлять наведення.
